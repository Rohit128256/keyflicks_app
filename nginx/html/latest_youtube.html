<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Secret Video Streaming platform</title>
<link href="https://vjs.zencdn.net/7.20.3/video-js.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<style>
* { margin:0; padding:0; box-sizing:border-box; font-family: 'Roboto', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
body { background: #0f0f0f; min-height:100vh; display:flex; flex-direction:column; align-items:center; justify-content: center; padding:20px; color:white; }
.container { max-width:1000px; width:100%; background:#0f0f0f; border-radius:12px; overflow:hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
header { text-align:center; padding:20px; background:#0f0f0f; border-bottom:1px solid rgba(255,255,255,0.1); }
h1 { font-size:2rem; margin-bottom:10px; color: #fff; font-weight:500; }
.subtitle { font-size:1rem; color:#aaa; max-width:600px; margin:0 auto; line-height:1.6; }
.video-input-section { padding:20px; background: rgba(255,255,255,0.05); border-bottom:1px solid rgba(255,255,255,0.1); }
#video-form { display:flex; gap:12px; justify-content:center; align-items:center; flex-wrap:wrap; }
#video-id-input { flex-grow:1; max-width:400px; padding:12px 15px; border-radius:24px; border:none; background:#272727; color:white; font-size:1rem; }
#video-form button { padding:12px 25px; border-radius:24px; border:none; background: #ff0000; color:white; font-size:1rem; font-weight:500; cursor:pointer; transition: background 0.2s ease; }
#video-form button:hover { background: #cc0000; }
#status-message { word-break: break-all; text-align:center; padding:12px; margin:15px 20px 0; border-radius:8px; display:none; font-size:1rem; }
.status-info { word-break: break-all; background: rgba(66, 133, 244, 0.2); border: 1px solid rgba(66, 133, 244, 0.4); color:#4285f4; }
.status-warning { word-break: break-all; background: rgba(255,165,0,0.2); border:1px solid rgba(255,165,0,0.4); color:orange; }
.status-error { word-break: break-all; background: rgba(255,0,0,0.2); border:1px solid rgba(255,0,0,0.4); color:#ff5252; }
.player-content-wrapper { display:none; }
.player-container { padding:0; background:#000; position:relative; border-radius: 12px; overflow: hidden; margin: 16px; }
.video-wrapper { position:relative; overflow:hidden; border-radius: 8px; }
.video-js { width:100%; height:0; padding-top:56.25%; }
/* YouTube-style control bar */
.video-js .vjs-control-bar {
  background: rgba(0, 0, 0, 0.7) !important;
  height: 48px !important;
  display: flex;
  align-items: center;
  padding: 0 12px !important;
  backdrop-filter: none;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
}
/* Left side controls */
.vjs-left-controls {
  display: flex;
  align-items: center;
  flex: 1;
  gap: 8px; /* Consistent spacing between controls */
}
/* Right side controls */
.vjs-right-controls {
  display: flex;
  align-items: center;
  justify-content: flex-end;
  gap: 8px; /* Consistent spacing between controls */
}
.video-js .vjs-progress-control {
  position: absolute;
  top: -8px;
  left: 0;
  right: 0;
  height: 8px;
  width: 100%;
}
.video-js .vjs-progress-holder {
  height: 100%;
  border-radius: 0;
  background: rgba(255, 255, 255, 0.2);
}
.video-js .vjs-play-progress {
  background: #ff0000;
}
.video-js .vjs-load-progress {
  background: rgba(255, 255, 255, 0.3);
}
.video-js .vjs-slider {
  background: rgba(255, 255, 255, 0.2);
}
/* Consistent control sizing */
.video-js .vjs-control {
  color: #fff;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* Icon-based controls - fixed width */
.video-js .vjs-play-control,
.video-js .vjs-volume-panel,
.video-js .vjs-playback-rate,
.video-js .vjs-quality-selector,
.video-js .vjs-fullscreen-control {
  width: 40px;
}

/* Time display controls - consistent padding */
.video-js .vjs-current-time,
.video-js .vjs-time-divider,
.video-js .vjs-duration {
  width: auto;
  padding: 0 4px;
  font-size: 13px;
}

/* Remove inconsistent margins */
.video-js .vjs-play-control,
.video-js .vjs-volume-panel,
.video-js .vjs-current-time,
.video-js .vjs-time-divider,
.video-js .vjs-duration,
.video-js .vjs-playback-rate,
.video-js .vjs-quality-selector,
.video-js .vjs-fullscreen-control {
  margin: 0 !important;
}

.video-js .vjs-play-control {
  order: 1;
}
.video-js .vjs-volume-panel {
  order: 2;
}
.video-js .vjs-current-time {
  order: 3;
  display: flex !important;
  font-size: 13px;
}
.video-js .vjs-time-divider {
  order: 4;
  display: flex !important;
  align-items: center;
  font-size: 13px;
}
.video-js .vjs-duration {
  order: 5;
  display: flex !important;
  font-size: 13px;
}
.video-js .vjs-progress-control {
  order: 6;
  flex-grow: 1;
  margin: 0 8px !important;
}
.video-js .vjs-playback-rate {
  order: 7;
}
.video-js .vjs-quality-selector {
  order: 8;
}
.video-js .vjs-fullscreen-control {
  order: 9;
}
/* Add margin to volume panel */
.video-js .vjs-volume-panel {
  margin-left: 13px !important;
}

/* Shift duration indicator slightly left */
.video-js .vjs-duration {
  margin-left: -14px !important;
}

/* YouTube-style buttons */
.video-js .vjs-control {
  color: #fff;
  width: auto;
  min-width: 32px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
}
.video-js .vjs-button > .vjs-icon-placeholder:before {
  line-height: 36px;
  font-size: 18px;
}
.video-js .vjs-volume-bar.vjs-slider-horizontal {
  height: 4px;
  width: 60px;
  margin: 0 8px;
}
.video-js:hover .vjs-progress-control {
  height: 8px;
}
.video-js .vjs-progress-control:hover {
  height: 8px;
}
/* Fix for progress bar handle */
.video-js .vjs-play-progress:before {
  position: absolute;
  top: -3px;
  right: -6px;
  font-size: 14px;
  z-index: 1;
  color: #ff0000;
}
.video-js .vjs-progress-control:hover .vjs-play-progress:before {
  top: -3px;
}
/* Picture-in-Picture button */
.vjs-pip-button {
  position: absolute;
  top: 15px;
  right: 15px;
  z-index: 100;
  width: 36px;
  height: 36px;
  border-radius: 50%;
  background: rgba(0, 0, 0, 0.6);
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  opacity: 0;
  transition: opacity 0.3s ease, transform 0.3s ease;
  transform: scale(0.9);
}
.video-wrapper:hover .vjs-pip-button {
  opacity: 1;
  transform: scale(1);
}
.vjs-pip-button i {
  font-size: 16px;
}
/* Hide PiP button in fullscreen */
.video-js.vjs-fullscreen + .video-wrapper .vjs-pip-button {
  display: none;
}
.info-section { display:flex; justify-content:space-between; padding:16px; background: rgba(255,255,255,0.05); margin:16px; border-radius:12px; }
.info-card { flex:1; padding:12px; background: rgba(255,255,255,0.03); border-radius:8px; margin:0 8px; text-align:center; }
.info-card h3 { color:#fff; margin-bottom:8px; font-size:1rem; font-weight:500; }
.info-card p { color:#aaa; font-size:0.9rem; }
.tech-badges { display:flex; justify-content:center; flex-wrap:wrap; gap:6px; margin-top:12px; }
.badge { background: rgba(255,0,0,0.2); color:#ff5252; padding:4px 8px; border-radius:12px; font-size:0.8rem; }
.features { display:grid; grid-template-columns: repeat(auto-fit, minmax(200px,1fr)); gap:16px; padding:0 16px 20px; }
.feature-card { background: rgba(255,255,255,0.03); padding:16px; border-radius:8px; text-align:center; transition: transform .3s ease, background .3s ease; }
.feature-card:hover { transform: translateY(-3px); background: rgba(255,255,255,0.06); }
.feature-card i { font-size:2rem; color:#ff0000; margin-bottom:12px; }
.feature-card h3 { margin-bottom:8px; color:#fff; font-weight:500; }
.feature-card p { color:#aaa; line-height:1.6; font-size:0.9rem; }
footer { text-align:center; padding:16px; color:#717171; font-size:0.85rem; border-top:1px solid rgba(255,255,255,0.1); }
@media (max-width:375px) { 
  .info-section { flex-direction:column } 
  .info-card { margin:8px 0 } 
  h1 { font-size:1.5rem } 
  .video-js .vjs-time-divider,
  .video-js .vjs-duration {
    display: none !important;
  }
}
/* Control bar fixes */
.video-js.vjs-fullscreen .vjs-control-bar {
  position: absolute !important;
  bottom: 0 !important;
  left: 0 !important;
  right: 0 !important;
  height: 48px !important;
  margin: 0 !important;
  padding: 0 12px !important;
}
.video-js.vjs-fullscreen {
  position: fixed !important;
  top: 0 !important;
  left: 0 !important;
  width: 100% !important;
  height: 100% !important;
  margin: 0 !important;
}
.video-js.vjs-fullscreen .vjs-progress-control {
  flex-grow: 1 !important;
}
.video-js .vjs-big-play-button { display: none !important; }
.video-js .vjs-playback-rate .vjs-menu-button-popup .vjs-menu .vjs-menu-content { background: rgba(28,28,28,0.95) !important; border-radius:8px; border:1px solid rgba(255,255,255,0.1); }
.video-js .vjs-menu-button-popup .vjs-menu { bottom:3em; }
.video-js .vjs-icon-placeholder:before { color:#fff; }
.error-message { display:none; position:absolute; top:50%; left:50%; transform: translate(-50%,-50%); background: rgba(200,50,50,0.8); padding:20px; border-radius:10px; text-align:center; z-index:10; max-width:80%; }
/* New CSS for upload functionality */
.mode-tabs { display: flex; justify-content: center; margin-bottom: 16px; }
.mode-tab { padding: 10px 20px; background: rgba(255,255,255,0.05); color: #aaa; border: none; cursor: pointer; font-size: 0.95rem; transition: all 0.3s ease; }
.mode-tab:first-child { border-radius: 20px 0 0 20px; }
.mode-tab:last-child { border-radius: 0 20px 20px 0; }
.mode-tab.active { background: #ff0000; color: white; }
.upload-section { display: none; padding: 20px; background: rgba(255,255,255,0.05); border-bottom: 1px solid rgba(255,255,255,0.1); }
.upload-form { display: flex; flex-direction: column; gap: 12px; max-width: 500px; margin: 0 auto; }
.file-input-wrapper { position: relative; overflow: hidden; display: inline-block; cursor: pointer; }
.file-input-wrapper input[type=file] { position: absolute; left: 0; top: 0; opacity: 0; cursor: pointer; height: 100%; width: 100%; }
.file-input-button { padding: 12px 20px; background: #ff0000; color: white; border-radius: 24px; text-align: center; cursor: pointer; }
.file-name { margin-top: 5px; font-size: 0.85rem; color: #aaa; }
.upload-button { padding: 12px 25px; border-radius: 24px; border: none; background: #ff0000; color: white; font-size: 1rem; font-weight:500; cursor: pointer; transition: background 0.2s ease; margin-top: 10px; }
.upload-button:hover { background: #cc0000; }
.upload-button:disabled { background: #555; cursor: not-allowed; }
.progress-bar { width: 100%; background: rgba(255,255,255,0.1); border-radius: 12px; overflow: hidden; margin-top: 12px; height: 6px; }
.progress { height: 100%; background: #ff0000; width: 0%; transition: width 0.3s ease; }
.sse-status { margin-top: 16px; padding: 12px; border-radius: 8px; background: rgba(66, 133, 244, 0.2); border: 1px solid rgba(66, 133, 244, 0.4); }
.success-message { margin-top: 16px; padding: 12px; border-radius: 8px; background: rgba(46,204,113,0.2); border: 1px solid rgba(46,204,113,0.4); color: #2ecc71; }
/* Fix for long video IDs on mobile */
.video-id-display {
  word-break: break-all;
  font-size: 0.85rem;
  line-height: 1.4;
  padding: 5px;
  background: rgba(255,255,255,0.05);
  border-radius: 4px;
  margin: 5px 0;
}
/* Custom quality selector styles */
.vjs-quality-selector {
  position: relative;
  display: inline-block;
  cursor: pointer;
}
.vjs-quality-selector .vjs-quality-button {
  background: none;
  border: none;
  color: inherit;
  font: inherit;
  padding: 0;
  margin: 0;
  width: auto;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  user-select: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
}
.vjs-quality-selector .vjs-quality-icon {
  font-family: "Font Awesome 5 Free";
  font-weight: 900;
  content: "\f013";
  font-size: 18px;
  width: auto;
  height: auto;
  display: flex;
  align-items: center;
  justify-content: center;
}
.vjs-quality-selector .vjs-quality-menu {
  position: absolute;
  bottom: 100%;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(28,28,28,0.95);
  border-radius: 8px;
  border: 1px solid rgba(255,255,255,0.1);
  min-width: 120px;
  z-index: 1000;
  display: none;
  box-shadow: 0 5px 15px rgba(0,0,0,0.3);
  margin-bottom: 8px;
}
.vjs-quality-selector .vjs-quality-menu.active {
  display: block;
}
.vjs-quality-selector .vjs-quality-menu-item {
  padding: 8px 15px;
  cursor: pointer;
  transition: background 0.2s;
  color: #fff;
  text-align: left;
  border-radius: 0;
  user-select: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  font-size: 0.9rem;
}
.vjs-quality-selector .vjs-quality-menu-item:first-child {
  border-top-left-radius: 8px;
  border-top-right-radius: 8px;
}
.vjs-quality-selector .vjs-quality-menu-item:last-child {
  border-bottom-left-radius: 8px;
  border-bottom-right-radius: 8px;
}
.vjs-quality-selector .vjs-quality-menu-item:hover {
  background: rgba(255,255,255,0.1);
}
.vjs-quality-selector .vjs-quality-menu-item.selected {
  color: #ff0000;
}
/* Custom playback rate styles */
.vjs-playback-rate-selector {
  position: relative;
  display: inline-block;
  cursor: pointer;
}
.vjs-playback-rate-selector .vjs-playback-rate-button {
  background: none;
  border: none;
  color: inherit;
  font: inherit;
  padding: 0;
  margin: 0;
  width: auto;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  user-select: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
}
.vjs-playback-rate-selector .vjs-playback-rate-icon {
  font-family: "Font Awesome 5 Free";
  font-weight: 900;
  content: "\f0e4";
  font-size: 18px;
  width: auto;
  height: auto;
  display: flex;
  align-items: center;
  justify-content: center;
}
.vjs-playback-rate-selector .vjs-playback-rate-menu {
  position: absolute;
  bottom: 100%;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(28,28,28,0.95);
  border-radius: 8px;
  border: 1px solid rgba(255,255,255,0.1);
  min-width: 100px;
  z-index: 1000;
  display: none;
  box-shadow: 0 5px 15px rgba(0,0,0,0.3);
  margin-bottom: 8px;
}
.vjs-playback-rate-selector .vjs-playback-rate-menu.active {
  display: block;
}
.vjs-playback-rate-selector .vjs-playback-rate-menu-item {
  padding: 8px 15px;
  cursor: pointer;
  transition: background 0.2s;
  color: #fff;
  text-align: left;
  border-radius: 0;
  user-select: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  font-size: 0.9rem;
}
.vjs-playback-rate-selector .vjs-playback-rate-menu-item:first-child {
  border-top-left-radius: 8px;
  border-top-right-radius: 8px;
}
.vjs-playback-rate-selector .vjs-playback-rate-menu-item:last-child {
  border-bottom-left-radius: 8px;
  border-bottom-right-radius: 8px;
}
.vjs-playback-rate-selector .vjs-playback-rate-menu-item:hover {
  background: rgba(255,255,255,0.1);
}
.vjs-playback-rate-selector .vjs-playback-rate-menu-item.selected {
  color: #ff0000;
}
/* Ensure icons are properly centered in control bar */
.video-js .vjs-control-bar {
  align-items: center !important;
}
.video-js .vjs-control {
  display: flex;
  align-items: center;
  justify-content: center;
}
/* Only show focus outline when navigating with keyboard */
.video-js .vjs-control:focus {
  outline: 2px solid #ff0000 !important;
  outline-offset: 2px !important;
}
.video-js .vjs-control:focus:not(:focus-visible) {
  outline: none !important;
}
body.keyboard-nav .video-js .vjs-control:focus {
  outline: 2px solid #ff0000 !important;
  outline-offset: 2px !important;
}
body:not(.keyboard-nav) .video-js .vjs-control:focus {
  outline: none !important;
}
/* Debounce fullscreen toggle */
.video-js .vjs-fullscreen-control {
  transition: transform 0.2s ease;
}
/* Increase touch target area for quality selector */
.vjs-quality-selector .vjs-quality-button {
  position: relative !important;
}
.vjs-quality-selector .vjs-quality-button::before {
  content: '';
  position: absolute;
  top: -8px;
  left: -8px;
  right: -8px;
  bottom: -8px;
  z-index: 1;
  cursor: pointer;
}
/* Increase touch target area for playback rate selector */
.vjs-playback-rate-selector .vjs-playback-rate-button {
  position: relative !important;
}
.vjs-playback-rate-selector .vjs-playback-rate-button::before {
  content: '';
  position: absolute;
  top: -8px;
  left: -8px;
  right: -8px;
  bottom: -8px;
  z-index: 1;
  cursor: pointer;
}
@media (max-width:350px) {
  .vjs-playback-rate-selector {
    display: none !important;
  }
}
/* YouTube-style title bar */
.player-title {
  padding: 12px 16px;
  background: rgba(255,255,255,0.03);
  border-bottom: 1px solid rgba(255,255,255,0.1);
  font-size: 1rem;
  color: #fff;
  display: none;
}
/* Responsive adjustments */
@media (max-width: 440px) {
  .video-js .vjs-volume-panel {
    display: none !important;
  }
  .video-js .vjs-current-time {
    margin-right: 4px;
  }
  .video-js .vjs-time-divider {
    padding: 0 2px;
  }
  .video-js .vjs-progress-control {
    margin: 0 8px;
  }
}
/* Loading spinner */
.vjs-loading-spinner {
  border: 3px solid rgba(255, 255, 255, 0.3);
  border-radius: 50%;
  border-top: 3px solid #ff0000;
  width: 40px;
  height: 40px;
  animation: spin 1s linear infinite;
  position: absolute;
  top: 50%;
  left: 50%;
  margin-top: -20px;
  margin-left: -20px;
  z-index: 10;
  display: none;
}
@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
/* Control groups for better organization */
.vjs-left-controls, .vjs-right-controls {
  display: flex;
  align-items: center;
}
.vjs-left-controls {
  flex: 1;
}
.vjs-right-controls {
  margin-left: auto;
}
/* Fix progress bar thickness on mouse leave */
.video-js .vjs-progress-control {
  transition: height 0.1s ease;
}
.video-js:not(:hover) .vjs-progress-control {
  height: 4px !important;
}
/* Ensure progress bar handle is properly positioned */
.video-js .vjs-slider-handle {
  top: -4px;
  width: 16px;
  height: 16px;
  border-radius: 50%;
  background-color: #ff0000;
  box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
}
.video-js .vjs-progress-control:hover .vjs-slider-handle {
  top: -6px;
  width: 18px;
  height: 18px;
}
</style>
</head>
<body>
<div class="container">
<header>
<h1>Secret Video Streaming Platform</h1>
<p class="subtitle">Watch secret videos using secret id or upload new content with our premium streaming service.</p>
</header>
<div class="mode-tabs">
<button class="mode-tab active" id="watch-tab">Watch Video</button>
<button class="mode-tab" id="upload-tab">Upload Video</button>
</div>
<div class="video-input-section" id="watch-section">
<form id="video-form">
<input type="text" id="video-id-input" placeholder="Enter Video ID here..." required>
<button type="submit">Load Video</button>
</form>
<div id="status-message"></div>
</div>
<div class="upload-section" id="upload-section">
<form class="upload-form" id="upload-form">
<div class="file-input-wrapper">
<div class="file-input-button">
<i class="fas fa-cloud-upload-alt"></i> Select Video File
</div>
<input type="file" id="video-file" accept="video/*" required>
<div class="file-name" id="file-name">No file selected</div>
</div>
<button type="submit" class="upload-button" id="upload-button" disabled>
<i class="fas fa-upload"></i> Upload Video
</button>
</form>
<div class="progress-bar" id="progress-bar" style="display: none;">
<div class="progress" id="progress"></div>
</div>
<div id="upload-status"></div>
<div id="sse-status" style="display: none;"></div>
<div id="success-message" class="success-message" style="display: none;"></div>
</div>
<div class="player-content-wrapper" id="player-content-wrapper">
<div class="player-title" id="player-title">Your Video</div>
<div class="player-container">
<div class="error-message" id="player-error-message">
<h3><i class="fas fa-exclamation-triangle"></i> Stream Error</h3>
<p id="error-text">Failed to load video stream</p>
</div>
<div class="video-wrapper">
<video id="my-video" class="video-js vjs-big-play-centered" controls preload="auto" tabindex="0"
poster="https://images.unsplash.com/photo-1574717024453-354056aafa98?auto=format&fit=crop&w=1200&q=80"
data-setup='{}'>
<p class="vjs-no-js">
To view this video please enable JavaScript, and consider upgrading to a web browser that
<a href="https://videojs.com/html5-video-support/" target="_blank">supports HTML5 video</a>
</p>
</video>
<div class="vjs-loading-spinner" id="loading-spinner"></div>
</div>
</div>
<div class="info-section">
<div class="info-card">
<h3>Stream Information</h3>
<p>Your Uploaded Content</p>
<p>Adaptive HLS Streaming</p>
<div class="tech-badges">
<span class="badge">HLS</span>
<span class="badge">Adaptive</span>
<span class="badge">Your Content</span>
</div>
</div>
<div class="info-card">
<h3>Player Features</h3>
<p>Quality Selection</p>
<p>Playback Speed Control</p>
<div class="tech-badges">
<span class="badge">Video.js</span>
<span class="badge">HD Ready</span>
</div>
</div>
</div>
<div class="features">
<div class="feature-card"><i class="fas fa-sliders-h"></i><h3>Quality Selection</h3><p>Manually choose between different resolutions for optimal viewing.</p></div>
<div class="feature-card"><i class="fas fa-tachometer-alt"></i><h3>Playback Speed</h3><p>Adjust video speed from 0.5x to 2.0x to watch at your pace.</p></div>
<div class="feature-card"><i class="fas fa-broadcast-tower"></i><h3>Adaptive Streaming</h3><p>Automatic quality adjustment for smooth playback.</p></div>
<div class="feature-card"><i class="fas fa-expand-arrows-alt"></i><h3>Fullscreen Mode</h3><p>Immersive viewing experience with high-definition fullscreen.</p></div>
</div>
<footer>
<p>Your Premium Streaming Service | Powered by Video.js</p>
</footer>
</div> </div>
<script src="https://vjs.zencdn.net/7.20.3/video.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/videojs-contrib-quality-levels@2.1.0/dist/videojs-contrib-quality-levels.min.js"></script>
<script>
// Tab switching functionality
const watchTab = document.getElementById('watch-tab');
const uploadTab = document.getElementById('upload-tab');
const watchSection = document.getElementById('watch-section');
const uploadSection = document.getElementById('upload-section');
watchTab.addEventListener('click', () => {
watchTab.classList.add('active');
uploadTab.classList.remove('active');
watchSection.style.display = 'block';
uploadSection.style.display = 'none';
});
uploadTab.addEventListener('click', () => {
uploadTab.classList.add('active');
watchTab.classList.remove('active');
uploadSection.style.display = 'block';
watchSection.style.display = 'none';
});
// Original player code
const videoForm = document.getElementById('video-form');
const videoIdInput = document.getElementById('video-id-input');
const statusMessage = document.getElementById('status-message');
const playerContentWrapper = document.getElementById('player-content-wrapper');
const playerErrorMessage = document.getElementById('player-error-message');
const errorText = document.getElementById('error-text');
const playerTitle = document.getElementById('player-title');
const loadingSpinner = document.getElementById('loading-spinner');
// Track current video ID for refreshing
let currentVideoId = null;
let sourceRefreshInterval = null;
// Initialize player with specific options
const player = videojs('my-video', {
bigPlayButton: false, // Completely remove the big play button
controlBar: {
children: [
'playToggle','volumePanel','currentTimeDisplay','timeDivider',
'durationDisplay','progressControl','qualitySelector','playbackRateSelector','fullscreenToggle'
],
volumePanel: {
  inline: false,
  vertical: false
}
},
html5: {
vhs: { // Updated from hls to vhs
overrideNative: true,
enableLowInitialPlaylist: true,
useNetworkInformationApi: true
}
},
nativeTextTracks: false
});
// Menu manager for exclusive menu opening
const menuManager = {
activeMenu: null,
closeAllMenus: function() {
// Close quality selector menu
if (qualitySelector && qualitySelector.menu) {
qualitySelector.menu.className = 'vjs-quality-menu';
}
// Close playback rate menu
if (playbackRateSelector && playbackRateSelector.menu) {
playbackRateSelector.menu.className = 'vjs-playback-rate-menu';
}
this.activeMenu = null;
}
};
// Create custom quality selector button
function createQualitySelector() {
// Remove existing quality selector if it exists
const existingSelector = document.querySelector('.vjs-quality-selector');
if (existingSelector) {
existingSelector.remove();
}
// Create quality selector container
const qualitySelector = document.createElement('div');
qualitySelector.className = 'vjs-quality-selector vjs-control';
// Create button
const button = document.createElement('button');
button.className = 'vjs-quality-button vjs-control';
button.innerHTML = '<i class="vjs-quality-icon fas fa-cog"></i>';
button.title = 'Quality';
button.setAttribute('role', 'button');
button.setAttribute('tabindex', '0');
button.style.userSelect = 'none';
button.style.webkitUserSelect = 'none';
button.style.MozUserSelect = 'none';
button.style.msUserSelect = 'none';
// Create menu
const menu = document.createElement('div');
menu.className = 'vjs-quality-menu';
// Add to control bar
qualitySelector.appendChild(button);
qualitySelector.appendChild(menu);
// Add to right controls
const rightControls = document.querySelector('.vjs-right-controls');
if (rightControls) {
rightControls.insertBefore(qualitySelector, rightControls.firstChild);
} else {
// Fallback to default position
const controlBar = player.controlBar.el();
const fullscreenControl = controlBar.querySelector('.vjs-fullscreen-control');
controlBar.insertBefore(qualitySelector, fullscreenControl);
}
// Toggle menu
button.addEventListener('click', (e) => {
e.stopPropagation();
// If this menu is already open, close it
if (menuManager.activeMenu === 'quality') {
menuManager.closeAllMenus();
} else {
// Close any open menu and open this one
menuManager.closeAllMenus();
menu.className = 'vjs-quality-menu active';
menuManager.activeMenu = 'quality';
}
});
// Prevent text cursor from appearing
button.addEventListener('mousedown', (e) => {
e.preventDefault();
});
// Return the selector object for external control
return {
element: qualitySelector,
menu: menu,
updateMenu: function(qualityLevels, currentQuality) {
// Clear existing menu items
menu.innerHTML = '';
// Add "Auto" option
const autoItem = document.createElement('div');
autoItem.className = 'vjs-quality-menu-item' + (currentQuality === null ? ' selected' : '');
autoItem.textContent = 'Auto';
autoItem.style.userSelect = 'none';
autoItem.style.webkitUserSelect = 'none';
autoItem.style.MozUserSelect = 'none';
autoItem.style.msUserSelect = 'none';
autoItem.addEventListener('click', () => {
// Enable all quality levels for auto
for (let i = 0; i < qualityLevels.length; i++) {
qualityLevels[i].enabled = true;
}
// Update selected item
document.querySelectorAll('.vjs-quality-menu-item').forEach(item => {
item.classList.remove('selected');
});
autoItem.classList.add('selected');
menuManager.closeAllMenus();
});
menu.appendChild(autoItem);
// Add quality level options
for (let i = 0; i < qualityLevels.length; i++) {
const level = qualityLevels[i];
const height = level.height || Math.round((level.bandwidth || 0) / 1000) + ' kbps';
const resolution = height + 'p';
const item = document.createElement('div');
item.className = 'vjs-quality-menu-item' + (currentQuality === i ? ' selected' : '');
item.textContent = resolution;
item.dataset.index = i;
item.style.userSelect = 'none';
item.style.webkitUserSelect = 'none';
item.style.MozUserSelect = 'none';
item.style.msUserSelect = 'none';
item.addEventListener('click', () => {
// Disable all quality levels except the selected one
for (let j = 0; j < qualityLevels.length; j++) {
qualityLevels[j].enabled = (j === i);
}
// Update selected item
document.querySelectorAll('.vjs-quality-menu-item').forEach(item => {
item.classList.remove('selected');
});
item.classList.add('selected');
menuManager.closeAllMenus();
});
menu.appendChild(item);
}
}
};
}
// Create custom playback rate selector
function createPlaybackRateSelector() {
// Remove existing playback rate selector if it exists
const existingSelector = document.querySelector('.vjs-playback-rate-selector');
if (existingSelector) {
existingSelector.remove();
}
// Create playback rate selector container
const rateSelector = document.createElement('div');
rateSelector.className = 'vjs-playback-rate-selector vjs-control';
// Create button
const button = document.createElement('button');
button.className = 'vjs-playback-rate-button vjs-control';
button.innerHTML = '<i class="vjs-playback-rate-icon fas fa-tachometer-alt"></i>';
button.title = 'Playback Rate';
button.setAttribute('role', 'button');
button.setAttribute('tabindex', '0');
button.style.userSelect = 'none';
button.style.webkitUserSelect = 'none';
button.style.MozUserSelect = 'none';
button.style.msUserSelect = 'none';
// Create menu
const menu = document.createElement('div');
menu.className = 'vjs-playback-rate-menu';
// Add to control bar
rateSelector.appendChild(button);
rateSelector.appendChild(menu);
// Add to right controls
const rightControls = document.querySelector('.vjs-right-controls');
if (rightControls) {
rightControls.insertBefore(rateSelector, rightControls.firstChild);
} else {
// Fallback to default position
const controlBar = player.controlBar.el();
const qualitySelector = controlBar.querySelector('.vjs-quality-selector');
controlBar.insertBefore(rateSelector, qualitySelector.nextSibling);
}
// Toggle menu
button.addEventListener('click', (e) => {
e.stopPropagation();
// If this menu is already open, close it
if (menuManager.activeMenu === 'playbackRate') {
menuManager.closeAllMenus();
} else {
// Close any open menu and open this one
menuManager.closeAllMenus();
menu.className = 'vjs-playback-rate-menu active';
menuManager.activeMenu = 'playbackRate';
}
});
// Prevent text cursor from appearing
button.addEventListener('mousedown', (e) => {
e.preventDefault();
});
// Return the selector object for external control
return {
element: rateSelector,
menu: menu,
updateMenu: function(currentRate) {
// Clear existing menu items
menu.innerHTML = '';
// Playback rates
const rates = [0.5, 0.75, 1, 1.25, 1.5, 1.75, 2];
// Add rate options
for (let i = 0; i < rates.length; i++) {
const rate = rates[i];
const rateText = rate.toFixed(2) + 'x';
const item = document.createElement('div');
item.className = 'vjs-playback-rate-menu-item' + (Math.abs(currentRate - rate) < 0.01 ? ' selected' : '');
item.textContent = rateText;
item.dataset.rate = rate;
item.style.userSelect = 'none';
item.style.webkitUserSelect = 'none';
item.style.MozUserSelect = 'none';
item.style.msUserSelect = 'none';
item.addEventListener('click', () => {
player.playbackRate(rate);
// Update selected item
document.querySelectorAll('.vjs-playback-rate-menu-item').forEach(item => {
item.classList.remove('selected');
});
item.classList.add('selected');
menuManager.closeAllMenus();
});
menu.appendChild(item);
}
}
};
}
// Create PiP button
function createPipButton() {
// Create PiP button
const pipButton = document.createElement('div');
pipButton.className = 'vjs-pip-button';
pipButton.innerHTML = '<i class="fas fa-clone"></i>';
pipButton.title = 'Picture-in-Picture';
// Add to video wrapper
const videoWrapper = document.querySelector('.video-wrapper');
videoWrapper.appendChild(pipButton);
// PiP functionality
pipButton.addEventListener('click', async () => {
try {
if (document.pictureInPictureElement) {
await document.exitPictureInPicture();
pipButton.innerHTML = '<i class="fas fa-clone"></i>';
} else {
const videoElement = player.el().querySelector('video');
if (videoElement) {
await videoElement.requestPictureInPicture();
pipButton.innerHTML = '<i class="fas fa-compress"></i>';
}
}
} catch (error) {
console.error('PiP error:', error);
}
});
// Update PiP button when PiP state changes
document.addEventListener('pictureinpicturechange', () => {
if (document.pictureInPictureElement) {
pipButton.innerHTML = '<i class="fas fa-compress"></i>';
} else {
pipButton.innerHTML = '<i class="fas fa-clone"></i>';
}
});
// Return the PiP button for external control
return {
element: pipButton,
updateState: function() {
if (document.pictureInPictureElement) {
pipButton.innerHTML = '<i class="fas fa-compress"></i>';
} else {
pipButton.innerHTML = '<i class="fas fa-clone"></i>';
}
}
};
}
// Create control groups
function createControlGroups() {
const controlBar = player.controlBar.el();
// Create left controls container
const leftControls = document.createElement('div');
leftControls.className = 'vjs-left-controls';
// Create right controls container
const rightControls = document.createElement('div');
rightControls.className = 'vjs-right-controls';
// Move existing controls to their respective groups
const playToggle = controlBar.querySelector('.vjs-play-control');
const volumePanel = controlBar.querySelector('.vjs-volume-panel');
const currentTime = controlBar.querySelector('.vjs-current-time');
const timeDivider = controlBar.querySelector('.vjs-time-divider');
const duration = controlBar.querySelector('.vjs-duration');
const progressControl = controlBar.querySelector('.vjs-progress-control');
const fullscreen = controlBar.querySelector('.vjs-fullscreen-control');
// Add to left controls
if (playToggle) leftControls.appendChild(playToggle);
if (volumePanel) leftControls.appendChild(volumePanel);
if (currentTime) leftControls.appendChild(currentTime);
if (timeDivider) leftControls.appendChild(timeDivider);
if (duration) leftControls.appendChild(duration);
// Add to right controls - we'll add quality and playback rate selectors later
// Add progress control to the middle
if (progressControl) {
controlBar.insertBefore(progressControl, controlBar.firstChild);
}
// Add control groups to the control bar
controlBar.appendChild(leftControls);
controlBar.appendChild(rightControls);
// Add fullscreen to right controls
if (fullscreen) rightControls.appendChild(fullscreen);
}
// Create quality selector and playback rate selector
let qualitySelector = null;
let playbackRateSelector = null;
let pipButton = null;
player.ready(function() {
console.log('Player ready');
// Create control groups
createControlGroups();
// Set playback rates
player.playbackRates([0.5, 0.75, 1, 1.25, 1.5, 1.75, 2]);
// Create custom quality selector
qualitySelector = createQualitySelector();
// Create custom playback rate selector
playbackRateSelector = createPlaybackRateSelector();
// Create PiP button
pipButton = createPipButton();
// Update playback rate menu initially
if (playbackRateSelector) {
playbackRateSelector.updateMenu(player.playbackRate());
}
// Add event listener for when source is loaded
player.on('loadeddata', function() {
console.log('Source loaded, checking quality levels');
updateQualitySelector();
loadingSpinner.style.display = 'none';
});
player.on('loadstart', function() {
loadingSpinner.style.display = 'block';
playerErrorMessage.style.display = 'none';
});
// Add event listener for playback rate changes
player.on('ratechange', function() {
if (playbackRateSelector) {
playbackRateSelector.updateMenu(player.playbackRate());
}
});
// Close menus when clicking outside
document.addEventListener('click', function(e) {
if (menuManager.activeMenu &&
!document.querySelector('.vjs-quality-selector')?.contains(e.target) &&
!document.querySelector('.vjs-playback-rate-selector')?.contains(e.target)) {
menuManager.closeAllMenus();
}
});
// Add keyboard shortcuts
document.addEventListener('keydown', function(e) {
// Only handle keyboard events when player is visible
if (!playerContentWrapper || !playerContentWrapper.style.display || playerContentWrapper.style.display === 'none') {
return;
}
// Prevent default behavior for spacebar to avoid scrolling
if (e.key === ' ') {
e.preventDefault();
}
// Always allow the 'f' key to toggle fullscreen regardless of focus
if (e.key.toLowerCase() === 'f') {
e.preventDefault();
e.stopPropagation();
if (player.isFullscreen()) {
player.exitFullscreen();
} else {
player.requestFullscreen();
}
// Ensure player gets focus after fullscreen change
setTimeout(() => {
player.el().focus();
}, 100);
return;
}
// Only handle other keys when player has focus or is in fullscreen
if ((!document.activeElement || !playerContentWrapper.contains(document.activeElement)) &&
!player.isFullscreen()) {
return;
}
switch(e.key.toLowerCase()) {
case ' ':
if (player.paused()) {
player.play();
} else {
player.pause();
}
break;
case 'arrowleft':
e.preventDefault(); // Prevent focus change
player.currentTime(Math.max(0, player.currentTime() - 5));
break;
case 'arrowright':
e.preventDefault(); // Prevent focus change
player.currentTime(player.currentTime() + 5);
break;
case 'm':
player.muted(!player.muted());
break;
}
});
// Detect keyboard navigation
document.addEventListener('keydown', function(e) {
if (e.key === 'Tab') {
document.body.classList.add('keyboard-nav');
}
});
document.addEventListener('mousedown', function() {
document.body.classList.remove('keyboard-nav');
});
// Handle fullscreen changes properly without causing buffering
player.on('fullscreenchange', function() {
console.log('Fullscreen mode changed. Is fullscreen:', player.isFullscreen());
// Force a reflow to ensure the control bar is positioned correctly
setTimeout(() => {
const controlBar = player.controlBar.el();
if (controlBar) {
// Ensure the control bar has the correct positioning
controlBar.style.position = 'absolute';
controlBar.style.bottom = '0';
controlBar.style.left = '0';
controlBar.style.right = '0';
controlBar.style.height = '48px';
// Force a reflow
void controlBar.offsetWidth;
}
// Ensure the player maintains focus in fullscreen mode
if (player.isFullscreen()) {
// Add a small delay to ensure the fullscreen transition completes
setTimeout(() => {
player.el().focus();
}, 100);
}
}, 50);
});
// Make sure the player can receive focus
player.el().setAttribute('tabindex', '0');
});
// Update quality selector with available quality levels
function updateQualitySelector() {
try {
if (!player.qualityLevels) return;
const qualityLevels = player.qualityLevels();
if (!qualityLevels || qualityLevels.length === 0) return;
// Find current quality level
let currentQuality = null;
for (let i = 0; i < qualityLevels.length; i++) {
if (qualityLevels[i].enabled === false) {
currentQuality = i;
break;
}
}
// Update quality selector menu
if (qualitySelector) {
qualitySelector.updateMenu(qualityLevels, currentQuality);
}
} catch (e) {
console.error('Error updating quality selector:', e);
}
}
function showStatus(message, type='info'){
statusMessage.textContent = message;
statusMessage.className = `status-${type}`;
statusMessage.style.display = 'block';
}
// Function to refresh the source to handle expired URLs
function refreshSource() {
if (!currentVideoId) return;
console.log('Refreshing video source...');
const playlistUrl = `/api/master/${currentVideoId}?t=${Date.now()}`;
// Store current playback state
const currentTime = player.currentTime();
const wasPaused = player.paused();
// Set new source
player.src({ src: playlistUrl, type: 'application/x-mpegURL' });
// Restore playback state
player.ready(function() {
player.currentTime(currentTime);
if (!wasPaused) {
player.play().catch(e => console.warn('Autoplay prevented after refresh', e));
}
// Update quality selector after refresh
setTimeout(updateQualitySelector, 1000);
});
}
// Form submit handler
videoForm.addEventListener('submit', async function (event) {
event.preventDefault();
const videoId = videoIdInput.value.trim();
if (!videoId) { showStatus('Please enter a Video ID.', 'error'); return; }
playerContentWrapper.style.display = 'none';
player.pause();
showStatus(`ðŸ” Validating Video ID: ${videoId}...`, 'info');
try {
const response = await fetch(`/api/status/${videoId}`);
if (response.status === 404) throw new Error('Video not found. Please check the ID and try again.');
if (!response.ok) throw new Error(`Server returned an error: ${response.statusText}`);
const data = await response.json();
if (data.status === 'ready') {
statusMessage.style.display = 'none';
playerContentWrapper.style.display = 'block';
playerTitle.style.display = 'block';
playerTitle.textContent = `Video: ${videoId}`;
// Store current video ID for refreshing
currentVideoId = videoId;
// Clear any existing refresh interval
if (sourceRefreshInterval) {
clearInterval(sourceRefreshInterval);
sourceRefreshInterval = null;
}
// Set up source refresh every 25 minutes (1500 seconds)
// Signed URLs expire after 1800 seconds, so refresh before that
sourceRefreshInterval = setInterval(refreshSource, 25 * 60 * 1000);
// Request the signed master playlist
const playlistUrl = `/api/master/${videoId}`;
// Set the source to the signed-master playlist endpoint
player.src({ src: playlistUrl, type: 'application/x-mpegURL' });
// Attempt autoplay
player.play().catch(e => console.warn('Autoplay prevented', e));
} else if (data.status === 'processing') {
showStatus('â³ This video is still processing. Please wait a few moments and try again.', 'warning');
} else {
throw new Error(`Unknown video status: "${data.status}"`);
}
} catch (err) {
console.error('Failed to load video:', err);
showStatus(`Error: ${err.message}`, 'error');
playerContentWrapper.style.display = 'none';
}
});
// Player error handling
player.on('error', function() {
const error = player.error();
console.error('Player error:', error);
// Check if error might be due to expired URLs
if (error && error.message && (
error.message.includes('403') ||
error.message.includes('Forbidden') ||
error.message.includes('Expired'))) {
console.log('Possible expired URL detected, refreshing source...');
refreshSource();
} else {
errorText.textContent = `Error: ${error ? error.message : 'Failed to load video stream'}`;
playerErrorMessage.style.display = 'block';
}
loadingSpinner.style.display = 'none';
});
player.on('loadstart', function() {
playerErrorMessage.style.display = 'none';
loadingSpinner.style.display = 'block';
});
// New upload functionality
const uploadForm = document.getElementById('upload-form');
const videoFileInput = document.getElementById('video-file');
const fileNameDisplay = document.getElementById('file-name');
const uploadButton = document.getElementById('upload-button');
const progressBar = document.getElementById('progress-bar');
const progress = document.getElementById('progress');
const uploadStatus = document.getElementById('upload-status');
const sseStatus = document.getElementById('sse-status');
const successMessage = document.getElementById('success-message');
let eventSource = null;
// Update file name display when a file is selected
videoFileInput.addEventListener('change', function() {
if (this.files.length > 0) {
const file = this.files[0];
fileNameDisplay.textContent = file.name;
uploadButton.disabled = false;
} else {
fileNameDisplay.textContent = 'No file selected';
uploadButton.disabled = true;
}
});
// Handle upload form submission
uploadForm.addEventListener('submit', async function(event) {
event.preventDefault();
const file = videoFileInput.files[0];
if (!file) {
showUploadStatus('Please select a video file.', 'error');
return;
}
// Clean filename (remove spaces and ensure extension)
const originalName = file.name;
const extension = originalName.slice(originalName.lastIndexOf('.'));
const cleanName = originalName.replace(/\s+/g, '') || 'video' + extension;
try {
showUploadStatus('Requesting upload URL...', 'info');
// Step 1: Get presigned URL
const response = await fetch(`/api/generate-upload-url/${cleanName}`, {
method: 'POST',
headers: {
'Content-Type': 'application/json'
}
});
if (!response.ok) {
throw new Error(`Failed to get upload URL: ${response.statusText}`);
}
const data = await response.json();
const { presigned_url, video_id, s3_key } = data;
showUploadStatus('Upload URL received. Starting upload...', 'info');
// Step 2: Set up SSE connection to monitor processing status
setupSSEConnection(video_id);
// Step 3: Upload file to presigned URL
progressBar.style.display = 'block';
const xhr = new XMLHttpRequest();
xhr.open('PUT', presigned_url, true);
xhr.setRequestHeader('Content-Type', file.type);
// Track upload progress
xhr.upload.addEventListener('progress', function(e) {
if (e.lengthComputable) {
const percentComplete = (e.loaded / e.total) * 100;
progress.style.width = percentComplete + '%';
showUploadStatus(`Uploading: ${Math.round(percentComplete)}% complete`, 'info');
}
});
xhr.onload = function() {
if (xhr.status === 200) {
showUploadStatus('Uploaded successfully! Now video will be processed so please wait...', 'info');
progressBar.style.display = 'none';
} else {
throw new Error(`Upload failed: ${xhr.statusText}`);
}
};
xhr.onerror = function() {
throw new Error('Upload failed due to network error');
};
xhr.send(file);
} catch (error) {
console.error('Upload error:', error);
showUploadStatus(`Error: ${error.message}`, 'error');
if (eventSource) eventSource.close();
}
});
function showUploadStatus(message, type) {
uploadStatus.textContent = message;
uploadStatus.className = `status-${type}`;
uploadStatus.style.display = 'block';
}
function setupSSEConnection(videoId) {
// Close existing connection if any
if (eventSource) {
eventSource.close();
}
sseStatus.style.display = 'block';
sseStatus.textContent = 'video processing will be started once video is uploaded and you will be notified once it is completed..';
sseStatus.className = 'status-info';
// Create new SSE connection
eventSource = new EventSource(`/api/stream-status/${videoId}`);
eventSource.onmessage = function(event) {
const payload = JSON.parse(event.data);
sseStatus.textContent = `Processing status: ${payload.data.status}`;
if (payload.data.status === 'ready') {
sseStatus.textContent = 'Processing completed successfully!';
sseStatus.className = 'status-info';
successMessage.style.display = 'block';
successMessage.innerHTML = `
<h3><i class="fas fa-check-circle"></i> Video Processing Complete</h3>
<p>Your video is now ready to watch!</p>
<p>Video ID: <span class="video-id-display">${videoId}</span></p>
<p>Copy this ID to watch your video later.</p>
`;
eventSource.close();
} else if (payload.data.status === 'failed') {
sseStatus.textContent = `Processing error: ${payload.message || 'Unknown error'}`;
sseStatus.className = 'status-error';
eventSource.close();
}
};
eventSource.onerror = function() {
sseStatus.textContent = 'Connection to status server lost. Processing may still continue.';
sseStatus.className = 'status-warning';
eventSource.close();
};
}
</script>
</body>
</html>