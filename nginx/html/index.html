<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Premium Video Player</title>
  <link href="https://vjs.zencdn.net/7.20.3/video-js.min.css" rel="stylesheet">
  <!-- plugin CSS -->
  <link rel="stylesheet" href="https://unpkg.com/videojs-hls-quality-selector@1.1.4/dist/videojs-hls-quality-selector.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body {
      background: linear-gradient(135deg, #0c152e, #230831, #0c152e);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 40px 20px;
      color: white;
    }
    
    .container {
      max-width: 1000px;
      width: 100%;
      background: rgba(10, 10, 20, 0.92);
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(100, 100, 200, 0.25);
      transition: transform 0.3s ease;
    }
    
    .container:hover {
      transform: translateY(-5px);
    }
    
    header {
      text-align: center;
      padding: 25px 20px;
      background: rgba(0, 0, 0, 0.55);
      border-bottom: 1px solid rgba(100, 100, 200, 0.3);
    }
    
    h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
      background: linear-gradient(to right, #4facfe, #00f2fe);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
      letter-spacing: 0.5px;
    }
    
    .subtitle {
      font-size: 1.1rem;
      color: #aaccff;
      max-width: 600px;
      margin: 0 auto;
      line-height: 1.6;
      opacity: 0.9;
    }

    .video-input-section {
      padding: 25px;
      background: rgba(0, 0, 0, 0.35);
      border-bottom: 1px solid rgba(100, 100, 200, 0.2);
    }

    #video-form {
      display: flex;
      gap: 15px;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
    }

    #video-id-input {
      flex-grow: 1;
      max-width: 400px;
      padding: 14px 18px;
      border-radius: 10px;
      border: 1px solid rgba(100, 150, 255, 0.35);
      background: rgba(0, 10, 30, 0.85);
      color: white;
      font-size: 1.05rem;
      transition: all 0.3s ease;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    }

    #video-id-input:focus {
      outline: none;
      border-color: #4facfe;
      box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.3);
    }

    #video-form button {
      padding: 14px 30px;
      border-radius: 10px;
      border: none;
      background: linear-gradient(to right, #4facfe, #00f2fe);
      color: white;
      font-size: 1.05rem;
      font-weight: bold;
      cursor: pointer;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      box-shadow: 0 4px 15px rgba(79, 172, 254, 0.4);
    }

    #video-form button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(79, 172, 254, 0.6);
    }

    #video-form button:active {
      transform: translateY(1px);
    }

    #status-message {
      text-align: center;
      padding: 18px;
      margin: 20px 25px 0;
      border-radius: 12px;
      display: none;
      font-size: 1.1rem;
      transition: all 0.4s ease;
      opacity: 0;
      transform: translateY(10px);
      animation: fadeInUp 0.5s forwards;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
    }

    @keyframes fadeInUp {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .status-info { 
      background: rgba(79, 172, 254, 0.25); 
      border: 1px solid rgba(79, 172, 254, 0.45); 
      color: #a0d6ff; 
    }
    
    .status-warning { 
      background: rgba(255, 165, 0, 0.25); 
      border: 1px solid rgba(255, 165, 0, 0.45); 
      color: #ffd699; 
    }
    
    .status-error { 
      background: rgba(255, 0, 0, 0.25); 
      border: 1px solid rgba(255, 0, 0, 0.45); 
      color: #ffb3b3; 
    }
    
    .player-content-wrapper {
      display: none;
      opacity: 0;
      transform: translateY(20px);
      animation: fadeInUp 0.7s forwards 0.3s;
    }

    .player-container {
      padding: 20px;
      background: #000;
      position: relative;
      border-radius: 0 0 20px 20px;
      overflow: hidden;
    }
    
    .video-wrapper {
      position: relative;
      overflow: hidden;
      border-radius: 12px;
      box-shadow: 0 12px 35px rgba(0, 0, 0, 0.9);
      transition: all 0.3s ease;
    }
    
    .video-js {
      width: 100%;
      height: 0;
      padding-top: 56.25%;
      border-radius: 12px;
      transition: all 0.3s ease;
    }
    
    .info-section { 
      display: flex; 
      justify-content: space-between; 
      padding: 25px 20px; 
      background: rgba(20, 30, 60, 0.75); 
      margin: 20px; 
      border-radius: 12px; 
      border: 1px solid rgba(100, 150, 255, 0.25); 
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }
    
    .info-card { 
      flex: 1; 
      padding: 20px; 
      background: rgba(0, 10, 30, 0.65); 
      border-radius: 12px; 
      margin: 0 10px; 
      text-align: center; 
      transition: all 0.3s ease;
    }
    
    .info-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
    }
    
    .info-card h3 { 
      color: #4facfe; 
      margin-bottom: 15px; 
      font-size: 1.3rem; 
      font-weight: 600;
    }
    
    .info-card p { 
      color: #cce5ff; 
      font-size: 1.05rem; 
      margin-bottom: 8px;
    }
    
    .tech-badges { 
      display: flex; 
      justify-content: center; 
      flex-wrap: wrap; 
      gap: 12px; 
      margin-top: 20px; 
    }
    
    .badge { 
      background: rgba(79, 172, 254, 0.25); 
      color: #a0d6ff; 
      padding: 6px 14px; 
      border-radius: 20px; 
      font-size: 0.9rem; 
      border: 1px solid rgba(79, 172, 254, 0.35); 
      transition: all 0.3s ease;
    }
    
    .badge:hover {
      background: rgba(79, 172, 254, 0.4);
      transform: translateY(-2px);
    }
    
    .features { 
      display: grid; 
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
      gap: 25px; 
      padding: 0 20px 30px; 
    }
    
    .feature-card { 
      background: rgba(20, 30, 60, 0.65); 
      padding: 25px 20px; 
      border-radius: 12px; 
      text-align: center; 
      border: 1px solid rgba(100, 150, 255, 0.25); 
      transition: all 0.3s ease; 
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.25);
    }
    
    .feature-card:hover { 
      transform: translateY(-7px); 
      background: rgba(30, 50, 100, 0.85); 
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4); 
    }
    
    .feature-card i { 
      font-size: 2.8rem; 
      color: #4facfe; 
      margin-bottom: 20px; 
      text-shadow: 0 0 15px rgba(79, 172, 254, 0.7); 
      transition: transform 0.3s ease;
    }
    
    .feature-card:hover i {
      transform: scale(1.1);
    }
    
    .feature-card h3 { 
      margin-bottom: 15px; 
      color: #4facfe; 
      font-size: 1.35rem;
    }
    
    .feature-card p { 
      color: #cce5ff; 
      line-height: 1.7; 
      font-size: 1.05rem;
    }
    
    footer { 
      text-align: center; 
      padding: 25px; 
      color: #88aaff; 
      font-size: 0.95rem; 
      border-top: 1px solid rgba(100, 150, 255, 0.25); 
      background: rgba(0, 0, 0, 0.3);
    }
    
    @media (max-width: 768px) { 
      .info-section { 
        flex-direction: column; 
      } 
      .info-card { 
        margin: 15px 0; 
      } 
      h1 { 
        font-size: 2rem; 
      } 
      .features {
        grid-template-columns: 1fr;
      }
    }
    
    .video-js .vjs-control-bar { 
      background: rgba(0, 10, 30, 0.85) !important; 
      backdrop-filter: blur(8px); 
      height: 50px !important;
    }
    
    .video-js .vjs-big-play-button { 
      background: rgba(79, 172, 254, 0.8) !important; 
      border: none !important; 
      width: 85px !important; 
      height: 85px !important; 
      border-radius: 50% !important; 
      line-height: 85px !important; 
      top: 50% !important; 
      left: 50% !important; 
      transform: translate(-50%, -50%); 
      font-size: 3.2em; 
      text-shadow: 0 0 15px rgba(0, 0, 0, 0.7); 
      transition: all 0.3s ease;
    }
    
    .video-js .vjs-big-play-button:hover {
      transform: translate(-50%, -50%) scale(1.1);
      background: rgba(79, 172, 254, 0.9) !important;
    }
    
    .video-js .vjs-playback-rate .vjs-menu-button-popup .vjs-menu .vjs-menu-content { 
      background: rgba(0, 10, 30, 0.95) !important; 
      border-radius: 10px; 
      border: 1px solid rgba(100, 150, 255, 0.35); 
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
    }
    
    .video-js .vjs-menu-button-popup .vjs-menu { 
      bottom: 3.5em; 
    }
    
    .video-js .vjs-icon-placeholder:before { 
      color: #4facfe; 
      text-shadow: 0 0 8px rgba(79, 172, 254, 0.7); 
    }
    
    .error-message { 
      display: none; 
      position: absolute; 
      top: 50%; 
      left: 50%; 
      transform: translate(-50%, -50%); 
      background: rgba(200, 50, 50, 0.85); 
      padding: 25px; 
      border-radius: 15px; 
      text-align: center; 
      z-index: 10; 
      max-width: 85%;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(200, 50, 50, 0.6); }
      70% { box-shadow: 0 0 0 15px rgba(200, 50, 50, 0); }
      100% { box-shadow: 0 0 0 0 rgba(200, 50, 50, 0); }
    }
    
    .loading-spinner {
      display: none;
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: 9;
      border-radius: 12px;
      align-items: center;
      justify-content: center;
    }
    
    .spinner {
      width: 60px;
      height: 60px;
      border: 5px solid rgba(79, 172, 254, 0.3);
      border-top: 5px solid #4facfe;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* Resolution selector styling */
    .video-js .vjs-quality-selector .vjs-menu-button {
      margin: 0;
      padding: 0;
      height: 100%;
      width: auto;
    }
    
    .video-js .vjs-quality-selector .vjs-icon-placeholder:before {
      content: "\f0a9";
      font-family: FontAwesome;
      font-size: 1.4em;
      line-height: 1.67;
    }
    
    .video-js .vjs-hls-quality-selector .vjs-menu .vjs-menu-content {
      background: rgba(0, 10, 30, 0.95) !important;
      border-radius: 10px;
      border: 1px solid rgba(100, 150, 255, 0.35);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
    }
    
    .video-js .vjs-hls-quality-selector .vjs-menu li {
      color: #cce5ff;
      padding: 10px 15px;
      font-size: 1.05rem;
      transition: all 0.2s ease;
    }
    
    .video-js .vjs-hls-quality-selector .vjs-menu li:hover {
      background: rgba(79, 172, 254, 0.3);
      color: white;
    }
    
    .video-js .vjs-hls-quality-selector .vjs-menu li.vjs-selected {
      background: rgba(79, 172, 254, 0.4);
      color: white;
    }
    
    /* Fallback selector styling */
    #quality-fallback-container {
      position: absolute;
      right: 15px;
      bottom: 60px;
      z-index: 1000;
      background: rgba(0, 10, 30, 0.9);
      border-radius: 8px;
      padding: 8px 12px;
      border: 1px solid rgba(100, 150, 255, 0.3);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    #quality-fallback-container label {
      color: #a0d6ff;
      font-size: 0.95rem;
    }
    
    #quality-fallback-select {
      background: rgba(0, 0, 0, 0.4);
      color: white;
      border: 1px solid rgba(100, 150, 255, 0.3);
      border-radius: 6px;
      padding: 6px 10px;
      font-size: 0.95rem;
      outline: none;
      transition: all 0.3s ease;
    }
    
    #quality-fallback-select:hover {
      border-color: #4facfe;
    }
    
    #quality-fallback-select:focus {
      border-color: #4facfe;
      box-shadow: 0 0 0 2px rgba(79, 172, 254, 0.3);
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Premium Video Stream</h1>
      <p class="subtitle">Enter a Video ID to load your HLS stream with full playback controls</p>
    </header>

    <div class="video-input-section">
      <form id="video-form">
        <input type="text" id="video-id-input" placeholder="Enter Video ID here..." required>
        <button type="submit">
          <i class="fas fa-play-circle"></i> Load Video
        </button>
      </form>
      <div id="status-message"></div>
    </div>

    <div class="player-content-wrapper" id="player-content-wrapper">
      <div class="player-container">
        <div class="loading-spinner" id="loading-spinner">
          <div class="spinner"></div>
        </div>
        
        <div class="error-message" id="player-error-message">
          <h3><i class="fas fa-exclamation-triangle"></i> Stream Error</h3>
          <p id="error-text">Failed to load video stream</p>
        </div>

        <div class="video-wrapper">
          <video id="my-video" class="video-js vjs-big-play-centered" controls preload="auto"
                 poster="https://images.unsplash.com/photo-1574717024453-354056aafa98?auto=format&fit=crop&w=1200&q=80"
                 data-setup='{}'>
            <p class="vjs-no-js">
              To view this video please enable JavaScript, and consider upgrading to a web browser that
              <a href="https://videojs.com/html5-video-support/" target="_blank">supports HTML5 video</a>
            </p>
          </video>
        </div>
      </div>

      <div class="info-section">
        <div class="info-card">
          <h3><i class="fas fa-info-circle"></i> Stream Information</h3>
          <p>Your Uploaded Content</p>
          <p>Adaptive HLS Streaming</p>
          <div class="tech-badges">
            <span class="badge">HLS</span>
            <span class="badge">Adaptive</span>
            <span class="badge">Your Content</span>
          </div>
        </div>

        <div class="info-card">
          <h3><i class="fas fa-sliders-h"></i> Player Features</h3>
          <p>Quality Selection</p>
          <p>Playback Speed Control</p>
          <div class="tech-badges">
            <span class="badge">Video.js</span>
            <span class="badge">HD Ready</span>
            <span class="badge">4K Support</span>
          </div>
        </div>
      </div>

      <div class="features">
        <div class="feature-card"><i class="fas fa-sliders-h"></i><h3>Quality Selection</h3><p>Manually choose between different resolutions for optimal viewing.</p></div>
        <div class="feature-card"><i class="fas fa-tachometer-alt"></i><h3>Playback Speed</h3><p>Adjust video speed from 0.5x to 2.0x to watch at your pace.</p></div>
        <div class="feature-card"><i class="fas fa-broadcast-tower"></i><h3>Adaptive Streaming</h3><p>Automatic quality adjustment for smooth playback.</p></div>
        <div class="feature-card"><i class="fas fa-expand-arrows-alt"></i><h3>Fullscreen Mode</h3><p>Immersive viewing experience with high-definition fullscreen.</p></div>
      </div>

      <footer>
        <p>Premium Streaming Service | Powered by Video.js</p>
      </footer>
    </div>
  </div>

  <!-- script order: vjs -> quality-levels -> plugin -->
  <script src="https://vjs.zencdn.net/7.20.3/video.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/videojs-contrib-quality-levels@2.1.0/dist/videojs-contrib-quality-levels.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/videojs-hls-quality-selector@1.1.4/dist/videojs-hls-quality-selector.min.js"></script>

  <script>
    const videoForm = document.getElementById('video-form');
    const videoIdInput = document.getElementById('video-id-input');
    const statusMessage = document.getElementById('status-message');
    const playerContentWrapper = document.getElementById('player-content-wrapper');
    const playerErrorMessage = document.getElementById('player-error-message');
    const errorText = document.getElementById('error-text');
    const loadingSpinner = document.getElementById('loading-spinner');

    // init player WITHOUT qualitySelector control
    const player = videojs('my-video', {
      controlBar: {
        children: [
          'playToggle','volumePanel','currentTimeDisplay','timeDivider',
          'durationDisplay','progressControl','remainingTimeDisplay',
          'customControlSpacer','playbackRateMenuButton','fullscreenToggle'
        ]
      }
    });

    player.ready(function() {
      console.log('Player ready');
      player.playbackRates([0.5,0.75,1,1.25,1.5,1.75,2]);
    });

    function showStatus(message, type='info'){
      statusMessage.innerHTML = `<i class="fas fa-${type === 'info' ? 'info-circle' : type === 'warning' ? 'exclamation-triangle' : 'exclamation-circle'}"></i> ${message}`;
      statusMessage.className = `status-${type}`;
      statusMessage.style.display = 'flex';
    }

    // helper: init plugin once with guard
    function initHlsQualitySelectorWithGuard() {
      if (player._hlsQualitySelectorInit) return;
      try {
        player.hlsQualitySelector({
          displayCurrentQuality: true,
          placementIndex: 8
        });
        player._hlsQualitySelectorInit = true;
        console.log('hlsQualitySelector initialized (guarded)');
      } catch (e) {
        console.warn('hlsQualitySelector init failed', e);
      }
    }

    // helper: inspect qualityLevels and log
    function logQualityLevels() {
      const ql = player.qualityLevels && player.qualityLevels();
      if (!ql) { console.log('No qualityLevels() API'); return null; }
      console.log('qualityLevels length =', ql.length);
      const info = [];
      for (let i = 0; i < ql.length; i++) {
        const lvl = ql[i];
        const obj = {
          index: i,
          height: lvl.height,
          width: lvl.width,
          bitrate: lvl.bitrate || lvl.bandwidth,
          id: lvl.id,
          enabled: lvl.enabled
        };
        console.log(i, obj);
        info.push(obj);
      }
      return info;
    }

    // fallback UI if plugin menu empty or heights missing
    function addQualityFallbackIfNeeded() {
      const ql = player.qualityLevels && player.qualityLevels();
      if (!ql || ql.length <= 1) return; // nothing to choose
      
      // If plugin created real menu items, don't add fallback
      const pluginMenuItems = document.querySelectorAll('.vjs-hls-quality-selector .vjs-menu-content li');
      if (pluginMenuItems && pluginMenuItems.length > 0) {
        console.log('plugin created menu items â€” no fallback needed');
        return;
      }

      // Avoid adding multiple fallbacks
      if (document.getElementById('quality-fallback-select')) return;

      const container = document.createElement('div');
      container.id = 'quality-fallback-container';
      
      const label = document.createElement('label');
      label.htmlFor = 'quality-fallback-select';
      label.textContent = 'Quality:';
      container.appendChild(label);
      
      const sel = document.createElement('select');
      sel.id = 'quality-fallback-select';
      sel.title = 'Quality';
      
      const autoOpt = document.createElement('option');
      autoOpt.value = 'auto';
      autoOpt.text = 'Auto';
      sel.appendChild(autoOpt);

      for (let i = 0; i < ql.length; i++) {
        const h = ql[i].height || Math.round((ql[i].bitrate||ql[i].bandwidth||0)/1000) + 'kbps';
        const o = document.createElement('option');
        o.value = String(i);
        o.text = (ql[i].height ? `${ql[i].height}p` : h);
        sel.appendChild(o);
      }

      sel.addEventListener('change', function() {
        const v = sel.value;
        if (v === 'auto') {
          for (let j = 0; j < ql.length; j++) ql[j].enabled = true;
          console.log('Quality: auto (all enabled)');
        } else {
          for (let j = 0; j < ql.length; j++) ql[j].enabled = (j === Number(v));
          console.log('Quality: forced to level', v);
        }
      });

      container.appendChild(sel);
      player.el().appendChild(container);
      console.log('Added quality fallback select because plugin menu was empty or heights missing.');
    }

    // wait for qualityLevels to populate (poll, up to timeout), then init plugin
    function waitAndInitQualitySelector(timeoutMs = 2000, intervalMs = 100) {
      let elapsed = 0;
      const t = setInterval(() => {
        const ql = player.qualityLevels && player.qualityLevels();
        if (ql && ql.length > 0) {
          console.log('qualityLevels detected, initializing plugin');
          clearInterval(t);
          logQualityLevels();
          initHlsQualitySelectorWithGuard();
          // small timeout to let plugin build menu before we check for fallback
          setTimeout(addQualityFallbackIfNeeded, 200);
          return;
        }
        elapsed += intervalMs;
        if (elapsed >= timeoutMs) {
          clearInterval(t);
          console.warn('Timed out waiting for qualityLevels. Will still attempt plugin init and fallback.');
          logQualityLevels();
          initHlsQualitySelectorWithGuard();
          setTimeout(addQualityFallbackIfNeeded, 300);
        }
      }, intervalMs);
    }

    // Show loading spinner
    function showSpinner() {
      loadingSpinner.style.display = 'flex';
    }
    
    // Hide loading spinner
    function hideSpinner() {
      loadingSpinner.style.display = 'none';
    }

    // form submit handler
    videoForm.addEventListener('submit', async function (event) {
      event.preventDefault();
      const videoId = videoIdInput.value.trim();
      if (!videoId) { 
        showStatus('Please enter a Video ID.', 'error'); 
        return; 
      }

      playerContentWrapper.style.display = 'none';
      player.pause();
      showStatus(`<i class="fas fa-search"></i> Validating Video ID: ${videoId}...`, 'info');
      showSpinner();

      try {
        const response = await fetch(`/api/status/${videoId}`);
        if (response.status === 404) throw new Error('Video not found. Please check the ID and try again.');
        if (!response.ok) throw new Error(`Server returned an error: ${response.statusText}`);
        const data = await response.json();

        if (data.status === 'ready') {
          statusMessage.style.display = 'none';
          playerContentWrapper.style.display = 'block';
          const videoUrl = `/api/master/${videoId}`;

          // set the source
          player.src({ src: videoUrl, type: 'application/x-mpegURL' });

          // WAIT for qualityLevels to be available and then init the plugin
          waitAndInitQualitySelector(2000, 100);

          // autoplay attempt
          player.play().catch(e => console.warn('Autoplay prevented', e));
          
          // Hide spinner when video starts playing
          player.one('playing', hideSpinner);
          
        } else if (data.status === 'processing') {
          showStatus('<i class="fas fa-hourglass-half"></i> This video is still processing. Please wait and try again.', 'warning');
          hideSpinner();
        } else {
          throw new Error(`Unknown video status: "${data.status}"`);
        }
      } catch (err) {
        console.error('Failed to load video:', err);
        showStatus(`<i class="fas fa-exclamation-circle"></i> Error: ${err.message}`, 'error');
        playerContentWrapper.style.display = 'none';
        hideSpinner();
      }
    });

    // player error handling
    player.on('error', function() {
      const error = player.error();
      console.error('Player error:', error);
      errorText.textContent = `Error: ${error ? error.message : 'Failed to load video stream'}`;
      playerErrorMessage.style.display = 'block';
      hideSpinner();
    });

    player.on('loadstart', function() {
      playerErrorMessage.style.display = 'none';
    });
  </script>
</body>
</html>